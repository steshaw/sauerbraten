<html>
  <head>
    <title>cube &raquo; Map Config and Scripting</title>
    <link rel="stylesheet" href="../style.css" type="text/css" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="wiki" id="content_view" style="display: block;">
<div id="toc"><h1 class="nopad">Table of Contents</h1><div style="margin-left: 1em;"><a href="#toc0">Introduction</a></div>
<div style="margin-left: 1em;"><a href="#toc1">Basic Uses</a></div>
<div style="margin-left: 2em;"><a href="#toc2">Cross-Platform</a></div>
<div style="margin-left: 1em;"><a href="#toc3">Textures</a></div>
<div style="margin-left: 2em;"><a href="#toc4">Shaders</a></div>
<div style="margin-left: 3em;"><a href="#toc5">shader</a></div>
<div style="margin-left: 3em;"><a href="#toc6">description</a></div>
<div style="margin-left: 1em;"><a href="#toc7">Sound</a></div>
<div style="margin-left: 1em;"><a href="#toc8">Triggers</a></div>
</div>
<a name="intro"></a><br />
<h1 id="toc0">Introduction</h1>
Once you've created a *.cfg file for your map:<br />

<ul>
    <li>Start Sauerbraten</li>
    <li>go to edit mode by pressing the E key one time</li>
    <li>and at the console, type :</li>
</ul>


<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">newmap</pre>


<ul>
    <li>Before editing anything, type:</li>
</ul>


<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">savemap mapnamehere</pre>


<ul>
    <li>Be sure that the name you save your map as, is the same name as your map.cfg file you created earlier.</li>
    <li>Finally, to put those new textures to work, at the console, type:</li>
</ul>


<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">map mapnamehere</pre>


<ul>
    <li>This will reload your map, and load your configuration file as well.</li>
</ul>

<br />
When you want to share your maps with own cfg with others you should package the content and distribute this package to everybody.<br />
Then they should simply need to extract to their own sauerbraten folder, find everything in place (nothing overwritten) and ready to go. Then just meet on any server and load the map, it will look fine.<br />
If you use the coop-edit mode to transfer a map, then only the geometry is passed and the map name will be unknown to you - so no way any but default_map_settings.cfg will be loaded ;)<br />
So either get some free webspace to put your maps on, email them to your friends or get an account on <a class="wiki_link_ext" href="http://www.quadropolis.us" rel="nofollow">quadropolis</a>.<br />
<br />
<br />
<a name="basic"></a><br />
<h1 id="toc1">Basic Uses</h1>
<br />
Each map will first load default_map_settings.cfg<br />
and then any package CFG and last the specific map CFG.<br />
So a map called metl4.ogz will call metl4.cfg.<br />
<br />
The first need for such a specific map configuration file will most likely arise when you want to have a special skybox background. For this enter<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">loadsky &quot;skyname&quot;
//loadsky &quot;ik2k/env/iklake&quot;
//loadsky &quot;socksy/mars&quot;</pre>

where skyname is the path to the 6 required images for a skybox. Check exisiting map CFGs for which skies are available and how to reference them exactly, currently the comment lines in the above code example should work.<br />
<br />
Second, the fog cut-off distance, and fog colour can be applied. For this enter<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">fog 2500 // can be set from 1 to 100000 as needed
fogcolour 16777215 // this is the max setting. This is also a hex parameter, 0XRRGGBB.</pre>

Third, you might want some ambient lighting. For this enter<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">ambient 15 // can be set from 1 to 255</pre>

Be carefull with the ambient option, as it reduces the texture contrast.<br />
To help converting RGB to HEX values this <a class="wiki_link_ext" href="http://www.kenjikojima.com/java/RGBHexConverter2.html" rel="nofollow">RGB &amp; Hex Converter</a> popped up on the forum.<br />
<br />
<br />
<a name="cross-platform"></a><br />
<h2 id="toc2">Cross-Platform</h2>
Beware that your filenames and cfg files match in all spelling of filenames -<br />
especially lower-/uppercase has often been the reason it didn't run somewhere else -<br />
also some platforms sometimes have issues with media.<br />
Known for jpg and mp3 from linux to windows for example.<br />
jpg might be fixed by saving in a windows app :-/ - no guarantee though;<br />
problem doesn't always arise anyway ;)<br />
For music OGG or MIDI are good formats for cross-platform friendliness,<br />
PNG textures also travel well.<br />
<br />
<br />
<a name="textures"></a><br />
<h1 id="toc3">Textures</h1>
<br />
The first thing to understand here is, the default map configuration is already in place. Unless you want to add new textures to your map, you do not need this part of a map.cfg Sauerbraten has a very large texture list by default. For the beginner mappers, this shoudl do fine. For the ones that need to add new textures, do the following -<br />
<br />
To explain the meaning of this parameter(s), the line &quot; texture 0 &quot;dg/trail_in.jpg&quot; &quot; for example. The first number after the word texture, stands for the type of texture it will be used as. There are several different types, but for now we'll just use type 0. the part of the line in &quot;&quot; is telling the engine where the texture is located. You must name this directory yourself. When working with a new texture list, you should never add to an original Sauerbraten directory. Create your new directory withing the packages directory.<br />
<br />
Start your map after creating this part of the maps .cfg file. You do not want to retexture anything.<br />
The first thing to add to the texture list section of a map.cfg file, is :<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">texturereset</pre>

This tells the engine to reset from the default configuration, and use the map.cfg for the texture list.<br />
After you reset the texture list, you need to add your own. The first 2 slots are &quot;reserved&quot; for the engine, and must be in every map.cfg file you use new textures with :<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">texture 0 &quot;ik2k/ik_sky_day_back.jpg&quot;
texture 0 &quot;golgotha/water2d.jpg&quot;</pre>

From this point on, you can add as many textures as you want ( up to 2^16 or 65,536 )<br />
You could also list the same texture more than once, to have rotated versions, by adding a number AFTER the texture name:<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">texture 0 &quot;dg/trail_in.jpg&quot; 0 // 0 = none, 1 = 90 CW, 2 = 180, 3 = 270 CW, 4 = X-axis flip, 5 = Y-axis flip</pre>

<br />
<a name="shaders"></a><br />
<h2 id="toc4">Shaders</h2>
<br />
Shaders are post processing effects applied to textures. They are used to provide added realism and depth to flat textures.<br />
<br />
You define a shader with:<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">setshader x
set*param index x y z w</pre>

<br />
You define textures to use as &quot;maps&quot; for the shaders using the following:<br />
<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">texture 0 &quot;texturename&quot; // default texture
texture d &quot;texturename&quot; // decal texture
texture n &quot;texturename&quot; // normal map
texture s &quot;texturename&quot; // specular map
texture g &quot;texturename&quot; // glow map
texture z &quot;texturename&quot; // depth (parallax) map
texture u &quot;texturename&quot; // undefined (currently used for sphere maps)</pre>

<br />
The following list was compiled from CVS sauerbraten after the 2006-12-04 &quot;gui&quot; edition release.<br />
Then the supported texture shaders were, check your local documentation and CFG files (data/stdshader.cfg):<br />


<table class="wiki_table">
    <tr>
        <td><h3 id="toc5">shader</h3>
</td>
        <td><h3 id="toc6">description</h3>
</td>
    </tr>
    <tr>
        <td>stdworld<br />
</td>
        <td>null shader; no params; uses 0 only<br />
</td>
    </tr>
    <tr>
        <td>decalworld<br />
</td>
        <td>decal shader; no params; uses 0, d<br />
</td>
    </tr>
    <tr>
        <td>glowworld<br />
</td>
        <td>glow map shader; setpixelparam 0 r g b; uses 0, g<br />
</td>
    </tr>
    <tr>
        <td>pulseworld<br />
</td>
        <td>pulse shader; setvertexparam 1 x; uses 0<br />
</td>
    </tr>
    <tr>
        <td>pulseglowworld<br />
</td>
        <td>pulsing glow map shader; setpixelparam 0 r g b, setvertexparam 1 x; uses 0, g<br />
</td>
    </tr>
    <tr>
        <td>metalworld<br />
</td>
        <td>sphere map shader; setpixelparam 0 r g b; uses 0, u<br />
</td>
    </tr>
    <tr>
        <td>bumpworld<br />
</td>
        <td>normal map shader; no params; uses 0, n<br />
</td>
    </tr>
    <tr>
        <td>bumpspecworld<br />
</td>
        <td>normal map shader with spec; setpixelparam 1 r g b; uses 0, n<br />
</td>
    </tr>
    <tr>
        <td>bumpspecmapworld<br />
</td>
        <td>normal, spec map shader; setpixelparam 1 r g b; uses 0, n, s<br />
</td>
    </tr>
    <tr>
        <td>bumpspecmapglowworld<br />
</td>
        <td>normal, spec, glow map shader; setpixelparam 0 r g b, setpixelparam 1 r g b; uses 0, n, s, g<br />
</td>
    </tr>
    <tr>
        <td>bumpspecparallaxworld<br />
</td>
        <td>normal, parallax map shader with spec; setpixelparam 1 r g b, setpixelparam 2 x y; uses 0, n, z<br />
</td>
    </tr>
    <tr>
        <td>bumpspecmapparallaxworld<br />
</td>
        <td>normal, parallax, spec map shader; setpixelparam 1 r g b, setpixelparam 2 x y; uses 0, n, s, z<br />
</td>
    </tr>
    <tr>
        <td>bumpspecmapparallaxglowworld<br />
</td>
        <td>normal, parallax, glow, spec map shader; setpixelparam 0 r g b; setpixelparam 1 r g b, setpixelparam 2 x y; uses 0, n, s, g, z<br />
</td>
    </tr>
</table>

<br />
preliminary copy from IRC log:<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">[19:40] &lt;KaiserTodretter&gt; bumpmaps are greyscale images that basically say what the heights of the different parts
                          of a texture are
[19:40] &lt;KaiserTodretter&gt; white being high spots and black being low spots
[19:41] &lt;KaiserTodretter&gt; bumpmaps make a texture appear not flat and distorts the texture in a way that it actually looks 3D
[19:42] &lt;KaiserTodretter&gt; normal maps are made from bumpmaps and are used to determined at what angles you will see the specularity of a texture
[19:43] &lt;KaiserTodretter&gt; the specularity can either be a constant set in the map config or a specmap texture can be made to show what parts
                          of the texture are shiney and what parts are dull
[19:43] &lt;KaiserTodretter&gt; the last thing you can add is glowmaps
[19:43] &lt;KaiserTodretter&gt; they dont actually 'emit' light to their surroundings
[19:44] &lt;KaiserTodretter&gt; but they are lit up even if there is no light on them
[19:44] &lt;KaiserTodretter&gt; you probably also noticed how as you move by certain textures you can see some shine on them
                          and it changes as you move by
[19:45] &lt;KaiserTodretter&gt; that is the spec and normal maps
[19:45] &lt;devoid&gt; ok
[19:45] &lt;devoid&gt; they make the &quot;shine&quot; effect ?
[19:45] &lt;devoid&gt; ill experiment some more
[19:46] &lt;KaiserTodretter&gt; the 'shine' itself comes from the specularity
[19:46] &lt;KaiserTodretter&gt; however using normal maps with that will make the shine appear at the correct angles
[19:46] &lt;devoid&gt; so, does it involve alot of work to make a set of such textures?
                 or is it pretty easy if you got the hang of it ?
[19:47] &lt;KaiserTodretter&gt; otherwise it will appear as if the texture is perfectly flat
[19:47] &lt;KaiserTodretter&gt; some are time consuming
[19:47] &lt;devoid&gt; well thx for the tips</pre>

<br />
<br />
<a name="sound"></a><br />
<h1 id="toc7">Sound</h1>
use the commands<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">music package_path/file.ogg
music package_path/file.mp3
&nbsp;
 // and/or
&nbsp;
snd_index = registersound package_path/file.wav
snd_index = registersound package_path/file.mp3
&nbsp;
level_trigger_42 = [
  sound $snd_index
]
 // and/or
&nbsp;
 // only WAVs allowed ATM, so do not add an extension!
&nbsp;
mapsound package_path/file_one
mapsound package_path/file_two 255
mapsound package_path/file_two 128
mapsound package_path/file_two 100
mapsound package_path/file_three 2
&nbsp;</pre>

to add individual sound fx to your map.<br />
The <strong>mapsound</strong> fills indexed slots for usage with <strong>sound</strong>-entities.<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">  //         X  R   F
newent sound 1 128 64</pre>

This would load the second slot (1st = 0) &quot;X&quot; onto that entity.<br />
At a radius of 128 you'd start/stop hearing it ... smaller than 64 and it'd be at full volume (see CFG).<br />
<br />
<a name="triggers"></a><br />
<h1 id="toc8">Triggers</h1>
Defining trigger actions - for SP maps only - is a vast field.<br />
You can basically define any scripting action inside a trigger alias,<br />
this will be parsed when the player enters the space of the trigger entity.<br />
<br />
Read the section about <a class="wiki_link_ext" href="http://sauerbraten.org/docs/editref.html#entitytypes" rel="nofollow">Entity Types</a> to understand what the tie-up with mapmodels is all about.<br />
<br />
You can start off trying out triggers with simple echo commands,<br />
then start scripting the action you'd like to happen.<br />
<br />
To see how doors work you can look at packages/base/door_demo.cfg - and of course the map too ;)<br />
A simplistic form of a <em>secret's counter</em> - can be found on the <a class="wiki_link" href="Scripting%20Tutorial.html#trigger101">Trigger 101</a> page.<br />
<br />
Try finding out how maps do stuff if you want to start using triggers yourself.<br />
Then try &quot;faking&quot; the action by calling your script by hand.<br />
Finally select an index for this action, say 42,<br />
then you'll simply need to place this scripting inside a<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">level_trigger_42 = [
  // your code here
]</pre>

alias and place triggers with tag 42 into the right places.<br />
To modify a placed triggers (default menu only has 0-8) tag :<br />

<style type="text/css"><!--
/* GeSHi (c) Nigel McNie 2004 (http://qbnz.com/highlighter) */
.text .imp {font-weight: bold; color: red;}

-->
</style><pre class="text">entproperty 3 +30
entproperty 3 +2
entproperty 3 -1</pre>


    </div>
  </body>
</html>